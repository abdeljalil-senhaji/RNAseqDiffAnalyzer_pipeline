rule blast:
    input:
        "{prefix}/{sample}/{sample}_not_hg38.all.fasta"
    output:
        "{prefix}/{sample}/{sample}_blast_parasite.txt"
    log:
        "{prefix}/{sample}/logs/{sample}_blast_parasite.log"
    params:
        blast_options = config["blast"]["OPTIONS"],
        blast_parasite = config["general_informations"]["DATABASE-Parasite"]
        #blast_fungi = config["general_informations"]["DATABASE-Fungi"]
    shell:
        'blastn -db {params.blast_parasite} {params.blast_options} -query {input} >  {wildcards.prefix}/{wildcards.sample}/{wildcards.sample}.blasttemp.txt | tee -a {log};\
        tac {wildcards.prefix}/{wildcards.sample}/{wildcards.sample}.blasttemp.txt | sed \'/0 hits/I,+3 d\' |tac > {output} | tee -a {log};\
        rm {wildcards.prefix}/{wildcards.sample}/{wildcards.sample}.blasttemp.txt'
        